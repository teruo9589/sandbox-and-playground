# 要件定義書

## はじめに

本ドキュメントは、Thymeleafを使用したSpring Boot開発環境をDockerコンテナ内で構築するための要件を定義します。既存のThymeleaf HTMLファイルを活用しながら、バックエンドのビジネスロジックを実行・検証できる完全な開発環境を提供することを目的としています。

## 用語集

- **開発環境**: Dockerコンテナ内で動作するSpring Bootアプリケーションの実行環境
- **フロントエンドコンテナ**: Thymeleafテンプレートを提供するWebアプリケーションコンテナ
- **バックエンドコンテナ**: Spring Bootアプリケーションのビジネスロジックを実行するコンテナ
- **データベースコンテナ**: PostgreSQLデータベースを実行するコンテナ
- **ビルドシステム**: Gradleを使用したプロジェクトのビルド管理システム
- **品質管理ツール**: CheckStyle、JaCoCo、SpotBugsなどのコード品質検証ツール

## 要件

### 要件1

**ユーザーストーリー:** 開発者として、最新のJavaとSpring Bootを使用した開発環境を構築したい。そうすることで、最新の機能とセキュリティアップデートを活用できる。

#### 受け入れ基準

1. WHEN プロジェクトを初期化する場合、開発環境 SHALL Java 25を使用する
2. WHEN プロジェクトを初期化する場合、開発環境 SHALL Spring Boot 4.0.0を使用する（利用不可能な場合は最新の安定版を使用する）
3. WHEN プロジェクトをビルドする場合、ビルドシステム SHALL Gradleを使用してビルドを実行する
4. WHEN 依存関係を管理する場合、ビルドシステム SHALL Lombokライブラリを含める
5. WHEN データベース接続を設定する場合、開発環境 SHALL Doma 3系を使用する

### 要件2

**ユーザーストーリー:** 開発者として、Dockerコンテナで分離された環境を構築したい。そうすることで、ローカル環境を汚さずに開発できる。

#### 受け入れ基準

1. WHEN Docker環境を起動する場合、開発環境 SHALL フロントエンドコンテナを起動する
2. WHEN Docker環境を起動する場合、開発環境 SHALL バックエンドコンテナを起動する
3. WHEN Docker環境を起動する場合、開発環境 SHALL データベースコンテナを起動する
4. WHEN コンテナ間で通信する場合、開発環境 SHALL Dockerネットワークを使用してコンテナ間通信を可能にする
5. WHEN データベースコンテナを起動する場合、データベースコンテナ SHALL PostgreSQLを実行する

### 要件3

**ユーザーストーリー:** 開発者として、既存のThymeleaf HTMLファイルを使用してビューを表示したい。そうすることで、既存の資産を活用できる。

#### 受け入れ基準

1. WHEN Thymeleafテンプレートをレンダリングする場合、フロントエンドコンテナ SHALL Thymeleafテンプレートエンジンを使用してHTMLを生成する
2. WHEN 既存のHTMLファイルを配置する場合、開発環境 SHALL テンプレートディレクトリに既存ファイルをマウントする
3. WHEN テンプレートを変更する場合、開発環境 SHALL ホットリロード機能を提供する
4. WHEN 静的リソースを提供する場合、フロントエンドコンテナ SHALL CSS、JavaScript、画像ファイルを提供する

### 要件4

**ユーザーストーリー:** 開発者として、バックエンドのビジネスロジックを実行・検証したい。そうすることで、画面表示だけでなく実際の処理を確認できる。

#### 受け入れ基準

1. WHEN HTTPリクエストを受信する場合、バックエンドコンテナ SHALL Spring MVCコントローラーでリクエストを処理する
2. WHEN ビジネスロジックを実行する場合、バックエンドコンテナ SHALL サービス層でビジネスロジックを実行する
3. WHEN データベースにアクセスする場合、バックエンドコンテナ SHALL Domaを使用してデータベース操作を実行する
4. WHEN データベース接続を確立する場合、バックエンドコンテナ SHALL PostgreSQLデータベースコンテナに接続する
5. WHEN ログを出力する場合、バックエンドコンテナ SHALL SLF4J + Logbackを使用してログを記録する

### 要件5

**ユーザーストーリー:** 開発者として、コード品質を自動的に検証したい。そうすることで、高品質なコードを維持できる。

#### 受け入れ基準

1. WHEN コーディング規約をチェックする場合、品質管理ツール SHALL CheckStyleを使用してコードスタイルを検証する
2. WHEN テストカバレッジを測定する場合、品質管理ツール SHALL JaCoCoを使用してカバレッジレポートを生成する
3. WHEN 静的解析を実行する場合、品質管理ツール SHALL SpotBugsを使用してバグパターンを検出する
4. WHEN ビルドを実行する場合、ビルドシステム SHALL 品質管理ツールをビルドプロセスに統合する
5. WHEN 品質チェックが失敗する場合、ビルドシステム SHALL ビルドを失敗させて問題を通知する

### 要件6

**ユーザーストーリー:** 開発者として、本番環境へのデプロイを想定した構成を理解したい。そうすることで、開発環境と本番環境のギャップを最小化できる。

#### 受け入れ基準

1. WHEN 本番環境にデプロイする場合、開発環境 SHALL フロントエンドとバックエンドを単一のアプリケーションとして統合する設計を採用する
2. WHEN 本番環境のデータベースを使用する場合、開発環境 SHALL AWS RDSへの接続設定を環境変数で切り替え可能にする
3. WHEN 環境設定を管理する場合、開発環境 SHALL 開発環境と本番環境で異なる設定プロファイルを使用する
4. WHEN Docker設定を作成する場合、開発環境 SHALL 本番環境用のDockerfileを別途提供する

### 要件7

**ユーザーストーリー:** 開発者として、簡単にプロジェクトをセットアップして起動したい。そうすることで、迅速に開発を開始できる。

#### 受け入れ基準

1. WHEN プロジェクトをセットアップする場合、開発環境 SHALL docker-compose.ymlファイルを提供する
2. WHEN 環境を起動する場合、開発環境 SHALL 単一のコマンドですべてのコンテナを起動する
3. WHEN 初回起動時にデータベースを初期化する場合、データベースコンテナ SHALL 初期化スクリプトを自動実行する
4. WHEN 開発環境を停止する場合、開発環境 SHALL すべてのコンテナを正常に停止する
5. WHEN 環境をクリーンアップする場合、開発環境 SHALL ボリュームとネットワークを削除するコマンドを提供する
